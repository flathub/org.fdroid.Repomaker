{
    "app-id": "org.fdroid.Repomaker",
    "runtime": "org.gnome.Platform",
    "runtime-version": "44",
    "sdk": "org.gnome.Sdk",
    "sdk-extensions": [
        "org.freedesktop.Sdk.Extension.openjdk11",
        "org.freedesktop.Sdk.Extension.rust-stable"
    ],
    "command": "repomaker",
    "finish-args" : [
        "--share=ipc",
        "--socket=x11",
        "--share=network",
        "--device=dri",
        "--socket=wayland",
        "--filesystem=home",
        "--env=PATH=/app/jre/bin:/app/bin:/usr/bin",
        "--env=JAVA_HOME=/app/jre"
    ],
    "modules": [
        "shared-modules/libsoup/libsoup-2.4.json",
        {
            "name": "rsync",
            "no-autogen": true,
            "config-opts": [
                "--prefix=${FLATPAK_DEST}",
                "--disable-debug",
                "--disable-xxhash"
            ],
            "cleanup": ["/share/man"],
            "sources": [{
                "type": "archive",
                "url": "https://download.samba.org/pub/rsync/src/rsync-3.2.7.tar.gz",
                "sha256": "4e7d9d3f6ed10878c58c5fb724a67dacf4b6aac7340b13e488fb2dc41346f2bb"
            }]
        },
        {
            "name": "git",
            "no-autogen": true,
            "make-args": ["INSTALL_SYMLINKS=1"],
            "make-install-args": ["INSTALL_SYMLINKS=1"],
            "sources": [{
                "type": "archive",
                "url": "https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.21.0.tar.gz",
                "sha256": "85eca51c7404da75e353eba587f87fea9481ba41e162206a6f70ad8118147bee"
            }]
        },
        {
            "name": "openjdk",
            "buildsystem": "simple",
            "build-commands" : [
              "/usr/lib/sdk/openjdk11/install.sh",
              "cp /usr/lib/sdk/openjdk11/jvm/openjdk-11/bin/jarsigner /app/jre/bin/"
            ]
        },
        {
            "name": "qhull",
            "buildsystem": "cmake-ninja",
            "sources": [
                {
                    "type": "archive",
                    "url": "http://www.qhull.org/download/qhull-2020-src-8.0.2.tgz",
                    "sha256": "b5c2d7eb833278881b952c8a52d20179eab87766b00b865000469a45c1838b7e"
                }
            ]
        },
        "python3-modules.json",
        {
            "name": "unifdef",
            "no-autogen": true,
            "make-install-args": [
                "prefix=${FLATPAK_DEST}"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://dotat.at/prog/unifdef/unifdef-2.12.tar.xz",
                    "sha256": "43ce0f02ecdcdc723b2475575563ddb192e988c886d368260bc0a63aee3ac400"
                }
            ],
            "cleanup": [ "*" ]
        },
        {
            "name": "webkit2gtk-4.0",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DPORT=GTK",
                "-DENABLE_BUBBLEWRAP_SANDBOX=OFF",
                "-DENABLE_DOCUMENTATION=OFF",
                "-DUSE_SOUP2=ON"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://webkitgtk.org/releases/webkitgtk-2.40.5.tar.xz",
                    "sha256": "7de051a263668621d91a61a5eb1c3771d1a7cec900043d4afef06c326c16037f",
                    "x-checker-data": {
                        "type": "html",
                        "url": "https://webkitgtk.org/releases/",
                        "version-pattern": "LATEST-STABLE-(\\d[\\.\\d]+\\d)",
                        "url-template": "https://webkitgtk.org/releases/webkitgtk-$version.tar.xz"
                    }
                }
            ]
        },
        {
            "name" : "repomaker",
            "buildsystem" : "simple",
            "build-commands" : [
                "install -Dm644 org.fdroid.Repomaker.svg /app/share/icons/hicolor/scalable/apps/${FLATPAK_ID}.svg",
                "install -Dm644 org.fdroid.Repomaker.desktop /app/share/applications/${FLATPAK_ID}.desktop",
                "install -Dm644 org.fdroid.Repomaker.appdata.xml /app/share/metainfo/${FLATPAK_ID}.appdata.xml",
                "pip3 install --no-index --ignore-requires-python --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} repomaker"
            ],
            "sources" : [
                {
                    "type" : "file",
                    "url" : "https://gitlab.com/fdroid/repomaker/raw/1.0.0b1/debian/data/org.fdroid.Repomaker.svg",
                    "sha256": "c6098a7fd5f00b0715777583df93a42910474f7c3d1bbd8679ad6e5a109be192"
                },
                {
                    "type" : "file",
                    "url" : "https://gitlab.com/fdroid/repomaker/raw/1.0.0b1/debian/data/org.fdroid.Repomaker.desktop",
                    "sha256": "70661cb9d77a14d540ad4e1748008147efee97139a50b52fca798231a9babc2b"
                },
                {
                    "type" : "file",
                    "url" : "https://gitlab.com/fdroid/repomaker/-/raw/master/debian/data/org.fdroid.Repomaker.appdata.xml",
                    "sha256": "e4cbc4ce6b60ba099f2b514ca32e264e968faef615438bdec9f17e2df87563e7"
                },
                {
                    "type" : "file",
                    "url" : "https://files.pythonhosted.org/packages/07/6d/9ee43c5c45a38a2238b6cc550cf577bd44e29d92d5458a43ac759b54ae50/repomaker-1.0.0b2.tar.gz",
                    "sha256": "6f6d0670a4eeb7431de2acb26c286b6b155bfc456d64ce5dbec691cbd2c9a5c0"
                }
            ]
        }
    ]
}
